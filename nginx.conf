load_module modules/ngx_http_js_module.so;

events {}

http {
    # Import your merged njs module (rename path if different)
    js_import app from /etc/nginx/conf.d/app.js;

    resolver 10.0.0.1;

    server {
        listen 8080;
        server_name localhost;

        # ---------------------------
        # Static content
        # ---------------------------
        location / {
            root /usr/share/nginx/html;
            index index.html;
        }

        location /home.png {
            alias /usr/share/nginx/html/home.png;
            types { image/png png; }
        }

        # ---------------------------
        # Dynamic JS-driven content
        # ---------------------------

        # Handles: /hello, /redirected, /response-headers, /scripts, /summary
        # plus iRule-style pages like /index-iframe.html, /iframe-http.html, etc.
        location ~ ^/(hello|redirected|response-headers|scripts|summary|index-iframe\.html|iframe-|framebust|xframes|webbug-|local-|offdomain|ondomain|sandbox-check) {
            js_content app.path_rule;
        }

        # /redirect still handled manually since it's a 302
        location = /redirect {
            js_content app.redirect;
        }

        # /hash demonstrates SHA-512 example
        location = /hash {
            js_content app.hash;
        }
    }
}